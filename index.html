<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Churrasco Eng em Forma√ß√£o</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      background-color: #121212;
      color: #e0e0e0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .container { max-width: 640px; margin: 0 auto; padding: 24px; }
    header img { width: 100%; height: auto; border-radius: 12px; box-shadow: 0 0 8px rgba(255, 255, 255, 0.1); }
    h1.title { text-align: center; margin: 20px 0 10px; font-size: 1.8rem; color: #ffffff; }
    .event-info-text { background-color: #1e1e1e; padding: 16px; border-radius: 10px; margin: 20px 0; box-shadow: 0 0 10px rgba(255, 255, 255, 0.05); }
    .info { display: flex; align-items: center; gap: 8px; font-weight: 500; margin-bottom: 8px; }
    a.add-calendar { color: #4dabf7; text-decoration: none; font-weight: 600; margin-top: 10px; display: inline-block; }
    a.add-calendar:hover { text-decoration: underline; }
    .location, .description { margin: 10px 0; color: #ccc; }
    .description { background-color: #1c1c1c; padding: 20px; border-radius: 10px; font-size: 0.95rem; box-shadow: inset 0 0 8px rgba(255, 255, 255, 0.03); }
    .buy-btn, button#continue-btn, button#submit-btn, button#confirmar-btn {
      display: block; width: 100%; padding: 14px; font-size: 1rem; font-weight: 700;
      color: white; background-color: #4dabf7; border: none; border-radius: 8px;
      cursor: pointer; margin-top: 20px; transition: background-color 0.3s ease;
    }
    .buy-btn:hover, button:hover { background-color: #339af0; }
    .voltar-btn {
      background-color: #333; color: #fff; border: none;
      padding: 10px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 10px;
    }
    .voltar-btn:hover { background-color: #555; }
    .ingresso-box {
      background-color: #1f1f1f; border: 1px solid #333; border-radius: 10px;
      padding: 16px 20px; margin-bottom: 20px; box-shadow: 0 0 4px rgba(255, 255, 255, 0.03);
    }
    .ingresso-box h3 { color: #90cdf4; margin-top: 0; margin-bottom: 12px; }
    .ingresso-box label { display: block; margin-bottom: 4px; font-weight: 600; }
    .ingresso-box input, .ingresso-box select, input, select {
      width: 100%; padding: 10px 14px; border-radius: 6px; border: 1px solid #444;
      background-color: #222; color: #eee; font-size: 1rem; font-weight: 500; margin-bottom: 12px;
    }
    input:focus, select:focus {
      outline: none; border-color: #4dabf7; background-color: #2a2a2a;
    }
    .resumo-box, .pix-box {
      background-color: #1c1c1c; border: 1px solid #333; border-radius: 10px;
      padding: 16px; margin-bottom: 20px; color: #ccc;
    }
    hr { border: none; border-top: 1px solid #444; margin: 12px 0; }
    @media screen and (max-width: 600px) { .container { padding: 16px; } }
  </style>
</head>
<body>
  <div class="container" id="main-container">
    <div id="inicio">
      <header>
        <img src="image/banner.jpeg" alt="Churrasco Eng em Forma√ß√£o Banner" />
      </header>
      <h1 class="title">Churrasco Eng em Forma√ß√£o</h1>
      <div class="event-info-text">
        <div class="info"><span>üóìÔ∏è</span> 23/08/2025</div>
        <div class="info"><span>‚è∞</span> 10:30</div>
        <a href="#" class="add-calendar" id="google-calendar-link">Adicionar ao calend√°rio</a>
        <div class="location">
          <p><strong>Rua Em√≠lio Roli, 200</strong></p>
          <p>Vila Gomes Cardim, Ourinhos ‚Äì SP</p>
        </div>
      </div>
      <div class="description">
        <p><strong>Descri√ß√£o do evento</strong></p>
        <p>
          Chegou a hora de garantir o seu ingresso pro nosso CHURRASCO ENG EM FORMA√á√ÉO! üî•ü•©<br />
          Dia 23/08/2025 ‚Äì a partir das 10h30<br />
          üìç R. Em√≠lio Roli, 200 ‚Äì Vila Gomes Cardim, Ourinhos ‚Äì SP
        </p>
        <p>
          Preencha os campos abaixo com suas informa√ß√µes, escolha a quantidade e o tipo de ingresso desejado e garanta j√° sua presen√ßa nesse evento que vai marcar a nossa jornada rumo ao CREA! üéìüí•
        </p>
        <p>
          üìå Aten√ß√£o: Todos os ingressos precisam conter nome completo, CPF, data de nascimento e o tipo de ingresso.
        </p>
        <p>
          üéü Tipos de ingresso:<br />
          Ingresso 1 ‚Äì Adulto com bebida: R$ 90,00<br />
          Ingresso 2 ‚Äì Adulto sem bebida: R$ 70,00<br />
          Ingresso 3 ‚Äì Crian√ßa: R$ 60,00
        </p>
        <p>üßä Cooler liberado / üçª Quem quiser relaxar, compre com bebida!</p>
      </div>
      <button class="buy-btn" id="btn-comprar">COMPRAR</button>
    </div>

    <div id="form-compra" style="display:none;">
      <h1 class="title">Compra de Ingressos</h1>
      <label for="quantidade">Quantidade de ingressos:</label>
      <input type="number" id="quantidade" min="1" max="10" value="1" required />
      <button id="continue-btn">Continuar</button>
      <form id="formulario" style="display:none;">
        <div id="ingressos"></div>
        <button type="submit" id="submit-btn">Finalizar Compra</button>
        <button type="button" class="voltar-btn" id="voltar-btn">‚Üê Voltar</button>
      </form>
    </div>

    <div id="resumo-final" style="display:none;">
      <h1 class="title">Fechamento de Carrinho</h1>
      <div class="resumo-box" id="detalhes-resumo"></div>
      <div class="pix-box">
        <p><strong>Pagamento via Pix</strong></p>
        <p>Chave Pix: (14)997969064</p>
        <p>Nome do recebedor: Pedro Henrique Sencio</p>
        <div id="resultado"></div>
      </div>
      <button class="buy-btn" id="confirmar-btn">Confirmar Compra</button>
      <button type="button" class="voltar-btn" id="voltar-btn">‚Üê Voltar</button>
    </div>
  </div>

  <script src="https://sdk.mercadopago.com/js/v2"></script>
  <script>
    const mp = new MercadoPago('APP_USR-223fc969-7591-4c3c-882e-3e98cf77439e', { locale: 'pt-BR' });
    let dados = [];
    let idCompraGlobal = '';

    mp.cardForm({ amount: "100", autoMount: true, form: { id: 'formulario' } }).then(form => {
      window.device_id = form.getCardFormData().deviceId;
    });

    document.getElementById('btn-comprar').onclick = () => {
      document.getElementById('inicio').style.display = 'none';
      document.getElementById('form-compra').style.display = 'block';
    };

    document.getElementById('continue-btn').onclick = () => {
      const qtd = parseInt(document.getElementById('quantidade').value);
      const container = document.getElementById('ingressos');
      container.innerHTML = '';
      for (let i = 1; i <= qtd; i++) {
        container.innerHTML += `
          <div class="ingresso-box">
            <h3>Ingresso ${i}</h3>
            <label>Nome completo:</label>
            <input type="text" id="nome_${i}" required />
            <label>CPF:</label>
            <input type="text" id="cpf_${i}" required />
            <label>Data de nascimento:</label>
            <input type="date" id="dtnasc_${i}" required />
            <label>Tipo de ingresso:</label>
            <select id="tipo_${i}" required>
              <option value="">Selecione</option>
              <option value="1">Adulto (com bebida) - R$90</option>
              <option value="2">Adulto (sem bebida) - R$70</option>
              <option value="3">Crian√ßa - R$60</option>
            </select>
          </div>`;
      }
      document.getElementById('formulario').style.display = 'block';
    };

    document.getElementById('formulario').onsubmit = async e => {
      e.preventDefault();
      const qtd = parseInt(document.getElementById('quantidade').value);
      let total = 0, html = '';
      idCompraGlobal = 'COMPRA-' + Date.now();
      dados = [];

      for (let i = 1; i <= qtd; i++) {
        const nome = document.getElementById(`nome_${i}`).value.trim();
        const cpf = document.getElementById(`cpf_${i}`).value.trim().replace(/\D/g, '');
        const nasc = document.getElementById(`dtnasc_${i}`).value;
        const tipo = document.getElementById(`tipo_${i}`).options[document.getElementById(`tipo_${i}`).selectedIndex].text;
        const valor = tipo.includes("R$90") ? 90 : tipo.includes("R$70") ? 70 : 60;
        total += valor;
        dados.push({ nome, cpf, nascimento: nasc, tipo, status_pagamento: 'Pendente', id_compra: idCompraGlobal });
        html += `<p><strong>Ingresso ${i}:</strong> ${tipo}<br>Nome: ${nome}<br>CPF: ${cpf}<br>Nasc: ${nasc}<br>Valor: R$${valor}</p><hr>`;
      }

      document.getElementById('detalhes-resumo').innerHTML = html + `<p><strong>Total: R$${total}</strong></p>`;
      document.getElementById('form-compra').style.display = 'none';
      document.getElementById('resumo-final').style.display = 'block';

      try {
        const response = await fetch('https://churrasco-uawh.onrender.com/gerar-pix', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nome: dados[0].nome, cpf: dados[0].cpf, valor: total, id_compra: idCompraGlobal, device_id: window.device_id })
        });
        const result = await response.json();
        if (!result.qr_code_base64) throw new Error('QR Code inv√°lido');
        dados.forEach(d => d.payment_id = result.payment_id);
        document.querySelector('.pix-box').innerHTML += `<img src="data:image/png;base64,${result.qr_code_base64}" width="300"><br><textarea style="width:300px; height:80px">${result.qr_code}</textarea>`;
        await fetch('https://churrasco-uawh.onrender.com/atualizar-sheets', {
          method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(dados)
        });
      } catch (err) {
        console.error(err);
        document.querySelector('.pix-box').innerHTML += '<p>Erro ao carregar o Pix. Tente novamente mais tarde.</p>';
      }
    };

    document.getElementById('voltar-btn').onclick = () => {
      document.getElementById('resumo-final').style.display = 'none';
      document.getElementById('inicio').style.display = 'block';
    };

    document.getElementById('google-calendar-link').onclick = e => {
      e.preventDefault();
      const url = `https://www.google.com/calendar/render?action=TEMPLATE&text=Churrasco%20Eng%20em%20Forma%C3%A7%C3%A3o&dates=20250823T103000/20250823T183000&details=Evento imperd√≠vel de confraterniza√ß√£o!&location=Rua%20Em%C3%ADlio%20Roli%2C%20200%2C%20Ourinhos%20-%20SP`;
      window.open(url, '_blank');
    };

    document.getElementById('confirmar-btn').onclick = () => {
      const texto = dados.map((d, i) => `Ingresso ${i + 1}: ${d.tipo}\nNome: ${d.nome}\nCPF: ${d.cpf}\nData: ${d.nascimento}`).join('\n\n');
      window.open(`https://wa.me/5514988348453?text=${encodeURIComponent('‚úÖ Compra confirmada!\n\n' + texto)}`);
    };
  </script>
</body>
</html>